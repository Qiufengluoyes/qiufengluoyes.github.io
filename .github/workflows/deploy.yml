# 构建 VitePress 站点并将其部署到 GitHub Pages 的示例工作流程
#
name: Deploy VitePress site to Pages

on:
  # 在针对 `main` 分支的推送上运行。如果你
  # 使用 `master` 分支作为默认分支，请将其更改为 `master`
  push:
    branches: [main]

  # 允许你从 Actions 选项卡手动运行此工作流程
  workflow_dispatch:

# 设置 GITHUB_TOKEN 的权限，以允许部署到 GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# 只允许同时进行一次部署，跳过正在运行和最新队列之间的运行队列
# 但是，不要取消正在进行的运行，因为我们希望允许这些生产部署完成
concurrency:
  group: pages
  cancel-in-progress: false

jobs:
  # 构建工作
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # 如果未启用 lastUpdated，则不需要
      - uses: pnpm/action-setup@v3 # 如果使用 pnpm，请取消注释
        with:
          version: 9
      # - uses: oven-sh/setup-bun@v1 # 如果使用 Bun，请取消注释
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: pnpm # 或 pnpm / yarn
      - name: Setup Pages
        uses: actions/configure-pages@v4
      - name: Install dependencies
        run: pnpm install # 或 pnpm install / yarn install / bun install
      - name: Build with VitePress
        run: pnpm run build # 或 pnpm build / yarn build / bun run build
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: .vitepress/dist

  # 部署工作
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    needs: build
    runs-on: ubuntu-latest
    name: Deploy
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
            - name: IndexNow Action
  # You may pin to the exact commit or the version.
  # uses: bojieyang/indexnow-action@cd6d1576582c1839b80dd71f418f172aa40d6552
  uses: bojieyang/indexnow-action@v2
  with:
    # The location of the sitemap(e.g., https://example.com/sitemap.xml).
    sitemap-location: 
    # URLs with `lastmod` fields in sitemap files within the last {since} {since-unit} will be submitted.
The default value is 1.

    since: # optional, default is 1
    # The unit of since. 
Available units are 'minute', 'hour', 'day', 'week', 'month' and 'year'.
The default value is 'day'.

    since-unit: # optional, default is day
    # The endpoint of a special search engine. 
Available units are api.indexnow.org, www.bing.com, search.seznam.cz and yandex.com. 
The default value is www.bing.com. For more details, see: https://www.indexnow.org/faq

    endpoint: # optional, default is www.bing.com
    # IndexNow key that you get from search engines.
NOTICE: DO NOT stored as plaintext in the workflow file. Use GitHub Secrets instead.
More about GitHub Secrets, see 'https://docs.github.com/en/actions/security-guides/encrypted-secrets'.

    key: 
    # Location of the IndexNow key file that you customed.
If not set, it will assume that there is a file named '{your-indexnow-key}.txt' in the root directory of the website.
NOTICE: DO NOT stored as plaintext in the workflow file. Use GitHub Secrets instead.
More about GitHub Secrets, see 'https://docs.github.com/en/actions/security-guides/encrypted-secrets'.

    key-location: # optional, default is 
    # The upper limit for submitting URLs.
    limit: # optional, default is 100
    # Set the fetch timeout in milliseconds. The default value is 10000.
    timeout: # optional, default is 10000
    # Define the strategy  when submit failed. Available strategy are ignore and error. 
For 'ignore', will outputting an notice only. 
For 'error', outputting an error message also sets the status of action to fail. 
The Default value is ignore.

    failure-strategy: # optional, default is ignore
    # If set to false, url entry without a `lastmod` tag in sitemap may be submitted, as long as the other conditions are met.
If set to true, url entry without a `lastmod` tag in sitemap will be excluded. This is the default behavior and can not be configured before.
However, there are some scenarios where the sitemap does not have a `lastmod` tag and it is difficult to set this tag, 
but they still want these URLs to be submitted.
This option is added to be compatible with this scenario.
since version 2.1.

    lastmod-required: # optional, default is true
          
